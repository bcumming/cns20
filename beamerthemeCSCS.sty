% \LaTeX beamer theme with CSCS style layout
% author: Maxime Martinasso <maxime.martinasso@cscs.ch>
% April, 21st, 2015

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeCSCS}[2015/04/21 CSCS beamer theme]
\RequirePackage{ifthen}
\RequirePackage[scaled=.85]{helvet}
\RequirePackage{tcolorbox}
\RequirePackage{listings}
\RequirePackage{xspace}

\newlength{\@headerdist}
\setlength{\@headerdist}{5mm}

\mode<presentation>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CSCS color definition
\definecolor{cscsred}{RGB}{172,27,38}
\definecolor{cscsgrey}{RGB}{64,64,64}
\definecolor{cscsgreen}{RGB}{114,121,28}
\definecolor{cscsblue}{RGB}{0,122,150}
\definecolor{cscsbrown}{RGB}{151,72,6}
\definecolor{cscspurple}{RGB}{128,0,128}
\definecolor{cscsyellow}{RGB}{167,135,32}
\definecolor{cscsblack}{RGB}{0,0,0}
\definecolor{cscswhite}{RGB}{255,255,255}

% no navigation
\setbeamertemplate{navigation symbols}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Block definitions

\tcbset{arc=0.4mm,boxrule=0.2mm}

\newenvironment<>{info}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[
colback=white,
colbacktitle=white!85!green,
coltitle=black,
colframe=black,
toptitle=1mm,
bottomtitle=1mm,
lefttitle=3mm,
leftupper=1mm,
leftlower=1mm,
rightupper=1mm,
rightlower=1mm,
boxsep=0mm,
title={#1}]}{\end{tcolorbox}}

\newenvironment<>{code}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[
colback=white,
colbacktitle=white!85!blue,
colframe=black,
coltitle=black,
toptitle=1mm,
bottomtitle=1mm,
lefttitle=3mm,
leftupper=1mm,
leftlower=1mm,
rightupper=1mm,
rightlower=1mm,
top=-1mm,
bottom=-1mm,
boxsep=0mm,
title={#1}]}{\end{tcolorbox}}

\newenvironment<>{terminal}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[
colback=white,
colbacktitle=white!85!blue,
colframe=black,
coltitle=black,
toptitle=1mm,
bottomtitle=1mm,
lefttitle=3mm,
leftupper=1mm,
leftlower=1mm,
rightupper=1mm,
rightlower=1mm,
top=-1mm,
bottom=-1mm,
boxsep=0mm,
title={#1}]}{\end{tcolorbox}}

\newenvironment<>{codecolumn}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[
colback=white!10!black,
colbacktitle=white!85!blue,
colframe=black,
coltitle=black,
toptitle=1mm,
bottomtitle=1mm,
lefttitle=3mm,
leftupper=1mm,
leftlower=1mm,
rightupper=1mm,
rightlower=1mm,
top=-1mm,
bottom=-1mm,
boxsep=0mm,
grow to left by=3mm,
grow to right by=3mm,
title=\footnotesize {#1}]}{\end{tcolorbox}}

\newenvironment<>{black0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=black,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{black1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=black,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{black2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=black,colbacktitle=white!75!black,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{green0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsgreen,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{green1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsgreen,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{green2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsgreen,colbacktitle=cscsgreen!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{blue0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsblue,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{blue1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsblue,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{blue2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsblue,colbacktitle=cscsblue!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{brown0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsbrown,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{brown1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsbrown,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{brown2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsbrown,colbacktitle=cscsbrown!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{purple0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscspurple,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{purple1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscspurple,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{purple2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscspurple,colbacktitle=cscspurple!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{yellow0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsyellow,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{yellow1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsyellow,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{yellow2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsyellow,colbacktitle=cscsyellow!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{red0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsred,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{red1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsred,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{red2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsred,colbacktitle=cscsred!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% inline syntax hilighting
\newcommand{\extra}{{\bfseries extra}:\xspace}
\newcommand{\lst}[1]{\colorbox{black}{\lstinline!#1!}}
%\newcommand{\lstterm}[1]{\colorbox{white}{\lstinline!#1!}}
\newcommand{\lstfont}[1]{\color{#1}\scriptsize\ttfamily}
\newcommand{\lsttinyfont}[1]{\color{#1}\fontsize{7}{7}\ttfamily}
\newcommand{\lstinlinefont}[1]{\color{#1}\scriptsize\ttfamily}
\newcommand{\todo}[1]{{\color{red}{#1}}}

\def\lstterm{\lstinline[basicstyle=\lstfont{black},keywordstyle={},identifierstyle={}]}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% source code listing boxes
\lstdefinestyle{terminal}{
    language=bash,
    showstringspaces=false,
    backgroundcolor=\color{white},
    basicstyle=\lsttinyfont{black},
    identifierstyle=\lsttinyfont{black},
    keywordstyle=\lsttinyfont{black},
    numberstyle=\lsttinyfont{black},
    stringstyle=\lsttinyfont{black},
    commentstyle=\lsttinyfont{green!30!black},
    emph={ srun, make, nvcc, salloc, git, ssh },
    emphstyle={\lsttinyfont{blue}},
    breaklines=true
}

\lstset{
    language=[ANSI]C++,
    showstringspaces=false,
    backgroundcolor=\color{white!10!black},
    basicstyle=\lstfont{black},
    identifierstyle=\lstfont{black},
    keywordstyle=\lstfont{black},
    numberstyle=\lstfont{white},
    stringstyle=\lstfont{cyan},
    commentstyle=\lstfont{yellow!30!white},
    moredelim=[is][\lsttinyfont{green!60!white}]{``}{``},
    emph={
        cudaMalloc, cudaFree,
        cudaDeviceSynchronize,
        cudaMallocHost, cudaFreeHost,
        cudaMallocManaged, cudaMemAttachGlobal,
        cudaMemcpyAsync, cudaMemcpy, cudaMemcpyKind,
        cudaMemcpyHostToDevice, cudaMemcpyDeviceToHost,
        cudaMemcpyHostToHost, cudaMemcpyDeviceToDevice,
        cudaSuccess, cudaGetLastError, cudaGetErrorString,
        cudaErrorMemoryAllocation, cudaError_t,
        cudaOccupancyMaxPotentialBlockSize,
        __global__, __shared__, __device__, __host__,
        __syncthreads,
        cudaEvent_t, cudaStream_t,
        cudaEventCreate, cudaEventSynchronize, cudaEventDestroy,
        cudaEventElapsedTime, cudaEventQuery, cudaEventRecord,
        cudaStreamWaitEvent,
        threadIdx, blockIdx, blockDim, gridDim,
        cudaStream_t, cudaStreamCreate, cudaStreamDestroy,
        dim3,
    },
    emphstyle={\lstfont{green!60!white}},
    breaklines=true
}

\definecolor{codenumber}{rgb}{0.5,0.5,0.5}
\definecolor{codekeyword}{rgb}{0.9,0.4,0.7}
\definecolor{codeCUDA}{rgb}{1.0,0.6,0.6}

\lstdefinelanguage{none}{identifierstyle=}
\lstdefinestyle{talkpseudo}{
    language=none,
    showstringspaces=false,
    backgroundcolor=\color{white},
    basicstyle=\lstfont{black},
    identifierstyle=\lstfont{blue!20!black},
    keywordstyle=\lstfont{magenta!40!black},
    numberstyle=\lstfont{black},
    stringstyle=\lstfont{blue},
    commentstyle=\lstfont{yellow!30!white},
    emphstyle={\lstfont{green!60!white}},
    breaklines=true
}

\lstdefinestyle{talkcpp}{
    language=[ANSI]C++,
    showstringspaces=false,
    backgroundcolor=\color{white},
    basicstyle=\lstfont{black},
    identifierstyle=\lstfont{blue!20!black},
    keywordstyle=\lstfont{magenta!40!black},
    numberstyle=\lstfont{black},
    stringstyle=\lstfont{blue},
    commentstyle=\lstfont{yellow!30!white},
    emphstyle={\lstfont{green!60!white}},
    breaklines=true
}

\lstdefinestyle{nmodl}{
    language=Python,
    showstringspaces=false,
    backgroundcolor=\color{white},
    basicstyle=\lsttinyfont{black},
    identifierstyle=\lsttinyfont{black},
    keywordstyle=\lsttinyfont{black},
    numberstyle=\lsttinyfont{blue},
    stringstyle=\lsttinyfont{black},
    commentstyle=\lsttinyfont{black},
    emphstyle=\lsttinyfont{black},
    breaklines=true
}

\lstdefinestyle{talkpython}{
    language=Python,
    showstringspaces=false,
    backgroundcolor=\color{white},
    basicstyle=\lsttinyfont{black},
    identifierstyle=\lsttinyfont{black},
    keywordstyle=\lsttinyfont{magenta!80!black},
    numberstyle=\lsttinyfont{blue},
    stringstyle=\lsttinyfont{blue},
    commentstyle=\lsttinyfont{green!50!black},
    emphstyle={\lsttinyfont{green!60!white}},
    breaklines=true
}

\lstdefinestyle{talkcuda}{
    language=[ANSI]C++,
    showstringspaces=false,
    backgroundcolor=\color{white},
    basicstyle=\lstfont{black},
    identifierstyle=\lstfont{black},
    keywordstyle=\lstfont{magenta},
    numberstyle=\lstfont{orange},
    stringstyle=\lstfont{green!80!black},
    commentstyle=\lstfont{blue!70!black},
    moredelim=[is][\lstfont{green!60!black}]{@}{@},
    emph={
        cudaMalloc, cudaFree,
        cudaDeviceSynchronize,
        cudaMallocHost, cudaFreeHost,
        cudaMallocManaged, cudaMemAttachGlobal,
        cudaMemcpyAsync, cudaMemcpy, cudaMemcpyKind,
        cudaMemcpyHostToDevice, cudaMemcpyDeviceToHost,
        cudaMemcpyHostToHost, cudaMemcpyDeviceToDevice,
        cudaSuccess, cudaGetLastError, cudaGetErrorString,
        cudaErrorMemoryAllocation, cudaError_t,
        cudaOccupancyMaxPotentialBlockSize,
        __global__, __shared__, __device__, __host__,
        __syncthreads,
        cudaEvent_t, cudaStream_t,
        cudaEventCreate, cudaEventSynchronize, cudaEventDestroy,
        cudaEventElapsedTime, cudaEventQuery, cudaEventRecord,
        cudaStreamWaitEvent,
        threadIdx, blockIdx, blockDim, gridDim,
        cudaStream_t, cudaStreamCreate, cudaStreamDestroy,
        dim3,
    },
    emphstyle={\lstfont{green!60!black}},
    breaklines=true
}

\lstdefinestyle{boxcuda}{
    language=[ANSI]C++,
    showstringspaces=false,
    backgroundcolor=\color{white!10!black},
    basicstyle=\lstfont{white},
    identifierstyle=\lstfont{white},
    keywordstyle=\lstfont{magenta!40!white},
    numberstyle=\lstfont{white},
    stringstyle=\lstfont{cyan},
    commentstyle=\lstfont{yellow!30!white},
    moredelim=[is][\lstfont{green!60!white}]{@}{@},
    emph={
        cudaMalloc, cudaFree,
        cudaDeviceSynchronize,
        cudaMallocHost, cudaFreeHost,
        cudaMallocManaged, cudaMemAttachGlobal,
        cudaMemcpyAsync, cudaMemcpy, cudaMemcpyKind,
        cudaMemcpyHostToDevice, cudaMemcpyDeviceToHost,
        cudaMemcpyHostToHost, cudaMemcpyDeviceToDevice,
        cudaSuccess, cudaGetLastError, cudaGetErrorString,
        cudaErrorMemoryAllocation, cudaError_t,
        cudaOccupancyMaxPotentialBlockSize,
        __global__, __shared__, __device__, __host__,
        __syncthreads,
        cudaEvent_t, cudaStream_t,
        cudaEventCreate, cudaEventSynchronize, cudaEventDestroy,
        cudaEventElapsedTime, cudaEventQuery, cudaEventRecord,
        cudaStreamWaitEvent,
        threadIdx, blockIdx, blockDim, gridDim,
        cudaStream_t, cudaStreamCreate, cudaStreamDestroy,
        dim3,
    },
    emphstyle={\lstfont{green!60!white}},
    breaklines=true
}

\lstdefinestyle{boxcudatiny}{
    language=[ANSI]C++,
    showstringspaces=false,
    backgroundcolor=\color{white!10!black},
    basicstyle=\lsttinyfont{white},
    identifierstyle=\lsttinyfont{white},
    keywordstyle=\lsttinyfont{magenta!40!white},
    numberstyle=\lsttinyfont{white},
    stringstyle=\lsttinyfont{cyan},
    commentstyle=\lsttinyfont{yellow!30!white},
    moredelim=[is][\lsttinyfont{green!60!white}]{@}{@},
    emph={
        cudaMalloc, cudaFree,
        cudaDeviceSynchronize,
        cudaMallocHost, cudaFreeHost,
        cudaMallocManaged, cudaMemAttachGlobal,
        cudaMemcpyAsync, cudaMemcpy, cudaMemcpyHostToDevice, cudaMemcpyDeviceToHost,
        cudaSuccess, cudaGetLastError, cudaGetErrorString,
        cudaErrorMemoryAllocation, cudaError_t,
        cudaOccupancyMaxPotentialBlockSize,
        __global__, __shared__, __device__, __host__,
        __syncthreads,
        cudaEvent_t, cudaStream_t,
        cudaEventCreate, cudaEventSynchronize, cudaEventDestroy,
        cudaEventElapsedTime, cudaEventQuery, cudaEventRecord,
        cudaStreamWaitEvent,
        threadIdx, blockIdx, blockDim, gridDim,
        cudaStream_t, cudaStreamCreate, cudaStreamDestroy,
        dim3,
    },
    emphstyle={\lstfont{green!60!white}},
    breaklines=true
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title frame
\setbeamertemplate{background canvas}{%
\ifnum\c@framenumber=1%First slide
\begin{picture}(0,40)
      \put(12,2){\includegraphics[scale=.25]{cscs_images/image4.pdf}}
      \put(250,4){\includegraphics[scale=.1]{images/arbor-logo.png}}
  \end{picture}
  \begin{picture}(0,0)
      \put(-2.5,-100){\includegraphics[width=\paperwidth]{\picturetitle}}
      \put(-2.5,-101){\color{cscsred}\rule{\paperwidth}{0.4mm}}
  \end{picture}
\fi%
}

\setbeamertemplate{frametitle}
{
  \ifbeamer@plainframe
  \else
    \vspace{.5cm}\hspace{-.5cm}
    \textbf{\color{cscsgrey}\insertframetitle}
    \vspace{-.2cm}
  \fi
}

% title page with CSCS image
\setbeamertemplate{title page}{
  \vspace{\@headerdist}
  \vspace{4.5cm}
  \hspace{-6.5mm}
  \textbf{\LARGE{\color{cscsgrey}\inserttitle}}\\[2mm]
  \normalsize
  \hspace{-6.5mm}
  {\color{gray}\insertsubtitle}\\
  \hspace{-6.5mm}
  {\color{gray}\insertauthor}\\
  \hspace{-6.5mm}
  {\color{gray}\insertdate}
}

\newcommand{\cscstitle}{
\begin{frame}[plain]
\titlepage
\end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Chapter title frame
\newcommand{\cscschapter}[1]{
\begin{frame}[plain]
\begin{picture}(0,0)
   \put(-16,71){\includegraphics[scale=.25]{cscs_images/image4.pdf}}
   \put(285,83){\includegraphics[scale=.29]{cscs_images/image1.pdf}}
\end{picture}
\begin{picture}(0,0)
   \put(-18,-22){\usebeamerfont{part title}\color{cscsgrey}\textbf{#1}}
   \put(-31,-28){\color{cscsred}\rule{\paperwidth}{0.4mm}}
\end{picture}
\end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Table of content frame
\setbeamercolor{section in toc}{fg=black}
\setbeamertemplate{section in toc}{
  \leavevmode
  \llap{%
      \makebox(5,5)[t]{
          \textcolor{cscsred}{\vrule width1mm height1mm depth.1mm}
      }
   }%
   \hspace{2mm}\inserttocsection\par
}
\setbeamertemplate{subsection in toc}{
  \leavevmode\leftskip=4ex%
  \llap{%
      \makebox(5,5)[t]{
          \textcolor{cscsgrey}{\vrule width1.5mm height0.2mm depth.1mm}
      }
   }%
   \hspace{2mm}\inserttocsubsection\par
}
\setbeamertemplate{subsubsection in toc}{
  \leavevmode\leftskip=9ex%
  \llap{%
      \makebox(5,5)[t]{
          \textcolor{black}{\tiny$\bullet$}
      }
   }%
   \hspace{2mm}\inserttocsubsubsection\par
}

\newcommand{\cscstableofcontents}[2][]{
\begin{frame}
\frametitle{#2}
\begin{columns}[T]
\begin{column}{.5\textwidth}
\includegraphics[width=157px, height=203px]{cscs_images/image8.jpeg}
\end{column}
\begin{column}{.5\textwidth}
\vspace{.2cm}
\tableofcontents[#1]
\end{column}
\end{columns}
\end{frame}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Footer with configurable text
\setbeamercolor{footline}{fg=gray}
\setbeamertemplate{footline}{
  \ifbeamer@plainframe
  \else
  \begin{picture}(0,0)
      \put(14,7){\includegraphics[scale=.14]{cscs_images/image2.pdf}}
      \put(158,11){{\fontsize{4.5}{5}\selectfont \footlinetext {\fontsize{6}{7}\selectfont\color{black}$\;\mid\,$} \color{gray}\insertframenumber}}
      \put(300,10){\includegraphics[scale=.05]{images/arbor-logo.png}}
  \end{picture}
  \fi
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Thank you frame
\newcommand{\cscsthankyou}[1]{
    \begin{frame}[noframenumbering,plain]
\begin{picture}(0,0)
   \put(-16,71){\includegraphics[scale=.25]{cscs_images/image4.pdf}}
   \put(285,83){\includegraphics[scale=.29]{cscs_images/image1.pdf}}
\end{picture}
\begin{picture}(0,0)
   \put(-31,-26){\includegraphics[width=\paperwidth]{cscs_images/image7.pdf}}
   \put(-31,-27){\color{cscsred}\rule{\paperwidth}{0.4mm}}
   \put(-18,-70){\textbf{\usebeamerfont{part title}\color{cscsgrey}#1}}
\end{picture}
    \end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Change itemize and enumerate
\setbeamertemplate{itemize item}{\makebox(5,5)[t]{\textcolor{cscsred}{\vrule width1mm height1mm depth.1mm}}}
\setbeamertemplate{itemize subitem}{\makebox(5,5)[t]{\textcolor{cscsgrey}{\vrule width1.5mm height0.2mm depth.1mm}}}
\setbeamertemplate{itemize subsubitem}{\makebox(5,5)[t]{\textcolor{black}{\tiny$\bullet$}}}

\setbeamertemplate{enumerate item}{\textcolor{cscsgrey}{\insertenumlabel.}}
\setbeamertemplate{enumerate subitem}{\textcolor{cscsgrey}{\insertenumlabel.\insertsubenumlabel}}
\setbeamertemplate{enumerate subsubitem}{\textcolor{cscsgrey}{\insertenumlabel.\insertsubenumlabel.\insertsubsubenumlabel}}
\setbeamertemplate{enumerate mini template}{\textcolor{cscsgrey}{\insertenumlabel}}


\mode
<all>
